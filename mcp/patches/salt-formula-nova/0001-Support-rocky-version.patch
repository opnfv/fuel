::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
: Copyright (c) 2018 Mirantis Inc., Enea AB and others.
:
: All rights reserved. This program and the accompanying materials
: are made available under the terms of the Apache License, Version 2.0
: which accompanies this distribution, and is available at
: http://www.apache.org/licenses/LICENSE-2.0
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
From: Michael Polenchuk <mpolenchuk@mirantis.com>
Date: Wed, 28 Nov 2018 17:55:45 +0400
Subject: [PATCH] Support rocky version

Change-Id: Ie7061f1b68ef3b203d4e169b60996a97ee6778c6
Related-Prod: PROD-23724

diff --git a/nova/map.jinja b/nova/map.jinja
index 370f517..d977d8d 100644
--- a/nova/map.jinja
+++ b/nova/map.jinja
@@ -18,12 +18,14 @@
 } %}

 {%- if grains.os_family == "Debian" %}
-{%- set pkgs_list = [ 'nova-common', 'nova-consoleproxy', 'novnc', 'nova-api', 'nova-conductor', 'nova-consoleauth', 'nova-doc', 'nova-scheduler', 'python-novaclient', 'python-memcache', 'gettext-base', 'python-pycadf'] %}
+{%- set pkgs_list = ['nova-api', 'nova-conductor', 'nova-consoleauth', 'nova-scheduler', 'python-novaclient'] %}
 {%- set services_list = ['nova-conductor', 'nova-api', 'nova-consoleauth', 'nova-scheduler', 'nova-novncproxy'] %}
-{%- if pillar.nova.controller is defined and pillar.nova.controller.get('version',{}) in ["juno", "kilo", "liberty", "mitaka"] %}
+{%- set ost_version = pillar.nova.controller is defined and pillar.nova.controller.get('version', None) %}
+{%- if ost_version in ['juno', 'kilo', 'liberty', 'mitaka'] %}
 {%- do pkgs_list.append('nova-cert') %}
 {%- do services_list.append('nova-cert') %}
 {%- endif %}
+{%- do pkgs_list.append('nova-novncproxy' if ost_version in ['rocky'] else 'nova-consoleproxy') %}
 {%- endif %}

 {%- if grains.os_family == "RedHat" %}
@@ -174,7 +176,7 @@ BaseDefaults: {{ default_params }}
 Debian:
   pkgs:
   - nova-common
-  - nova-compute-kvm
+  - nova-compute
   - python-novaclient
   - pm-utils
   - sysfsutils
