::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
: Copyright (c) 2017 Mirantis Inc., Enea AB and others.
:
: All rights reserved. This program and the accompanying materials
: are made available under the terms of the Apache License, Version 2.0
: which accompanies this distribution, and is available at
: http://www.apache.org/licenses/LICENSE-2.0
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
From: Guillermo Herrero <guillermo.herrero@enea.com>
Date: Mon, 20 Nov 2017 11:33:29 +0100
Subject: [PATCH] extend public gateway support

JIRA: FUEL-305

Change-Id: Ic5a2d499925aeec5b597394a059640ddae83fb2d
Signed-off-by: Guillermo Herrero <guillermo.herrero@enea.com>
---
 config/installers/fuel/pod_config.yml.j2 | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/config/installers/fuel/pod_config.yml.j2 b/config/installers/fuel/pod_config.yml.j2
index eccdf5c..b6e868c 100644
--- a/config/installers/fuel/pod_config.yml.j2
+++ b/config/installers/fuel/pod_config.yml.j2
@@ -8,6 +8,9 @@
     {%- if conf.net_config.public.dns is defined -%}
         {%- set dns_public = conf['net_config']['public']['dns'] -%}
     {%- endif -%}
+    {%- if conf.net_config.public.gateway is defined -%}
+        {%- set net_public_gw = conf['net_config']['public']['gateway'] -%}
+    {%- endif -%}
     {%- set pxe_interface = conf['net_config']['admin']['interface'] -%}
 {%- else -%}
     {%- set net_admin = '192.168.11.0' -%}
@@ -22,6 +25,10 @@
 {%- if dns_public is not defined -%}
     {%- set dns_public = [ '8.8.8.8', '8.8.4.4' ] -%}
 {%- endif -%}
+{%- if net_public_gw is not defined -%}
+    {%- set net_public_gw =  net_public | ipaddr_index('1')  -%}
+{%- endif -%}
+
 ---
 parameters:
   _param:
@@ -55,6 +62,8 @@ parameters:
     opnfv_openstack_proxy_address: {{ net_public | ipaddr_index('103') }}
     opnfv_openstack_proxy_node01_address: {{ net_public | ipaddr_index('104') }}
     opnfv_openstack_proxy_node02_address: {{ net_public | ipaddr_index('105') }}
+    opnfv_openstack_proxy_node01_control_address: {{ net_mgmt | ipaddr_index('104') }}
+    opnfv_openstack_proxy_node02_control_address: {{ net_mgmt | ipaddr_index('105') }}
     opnfv_openstack_control_address: {{ net_mgmt | ipaddr_index('10') }}
     opnfv_openstack_control_node01_address: {{ net_mgmt | ipaddr_index('11') }}
     opnfv_openstack_control_node02_address: {{ net_mgmt | ipaddr_index('12') }}
@@ -85,6 +94,7 @@ parameters:

     opnfv_opendaylight_server_node01_single_address: {{ net_mgmt | ipaddr_index('111') }}

+    opnfv_net_public_gw: {{ net_public_gw }}
     opnfv_name_servers: {{ dns_public }}
     opnfv_dns_server01: '{{ dns_public[0] }}'

