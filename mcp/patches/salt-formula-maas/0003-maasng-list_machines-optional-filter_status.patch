::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
: Copyright (c) 2018 Mirantis Inc., Enea AB and others.
:
: All rights reserved. This program and the accompanying materials
: are made available under the terms of the Apache License, Version 2.0
: which accompanies this distribution, and is available at
: http://www.apache.org/licenses/LICENSE-2.0
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
From: Alexandru Avadanii <Alexandru.Avadanii@enea.com>
Date: Sat, 22 Sep 2018 20:14:10 +0200
Subject: [PATCH] maasng: list_machines optional filter_status

Signed-off-by: Alexandru Avadanii <Alexandru.Avadanii@enea.com>
---
 _modules/maasng.py | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/_modules/maasng.py b/_modules/maasng.py
index c08d5db..0f0ef4d 100644
--- a/_modules/maasng.py
+++ b/_modules/maasng.py
@@ -128,7 +128,7 @@ def get_machine(hostname):
         return {"error": "Machine not found on MaaS server"}


-def list_machines():
+def list_machines(status_filter=None):
     """
     Get list of all machines from maas server

@@ -137,12 +137,14 @@ def list_machines():
     .. code-block:: bash

         salt 'maas-node' maasng.list_machines
+        salt 'maas-node' maasng.list_machines status_filter=[Deployed,Ready]
     """
     machines = {}
     maas = _create_maas_client()
     json_res = json.loads(maas.get(u'api/2.0/machines/').read())
     for item in json_res:
-        machines[item["hostname"]] = item
+        if not status_filter or item['status_name'] in status_filter:
+            machines[item["hostname"]] = item
     return machines


