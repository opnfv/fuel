##############################################################################
# Copyright (c) 2015 Ericsson AB and others.
# jonas.bjurel@ericsson.com
# All rights reserved. This program and the accompanying materials
# are made available under the terms of the Apache License, Version 2.0
# which accompanies this distribution, and is available at
# http://www.apache.org/licenses/LICENSE-2.0
##############################################################################

############################################################################### # Description:
# This .yaml configuration file defines the configuration of the fuel
# deployment and is passed as an argument to deploy.sh
# eg. deploy.sh -c https://artifact.opnfv.org/fuel/config
# This will make build.sh fetch this configuration file and configure the
# deployment accordingly.
# After the deployment, a copy of this file gets uploaded to fuel:
# /root/deploy-config.yaml, as well as the sha-1 sum of this file:
# /root/deploy-config.sha1
##############################################################################

##############################################################################
# deployment configuration meta-data
deployment-scenario-metadata:
   title: ONOS No-HA deployment
   version: 0.0.3
   created: Jan 13 2016
   comment: ONOS No HA with Ceph, Ceilometer and Heat

##############################################################################
# Stack extentions are opnfv added value features in form of a fuel-plugin
# plug-ins listed below will be enabled and configured according to the
# <module-config-base-uri>/<module-config-name>_<module-config-version>.yaml
# It does so by copying the config file to the local plugin config directory
stack-extensions:
   - module: onos
     module-config-name: fuel-onos
     module-config-version: 0.0.1
     module-config-override:
       # Module config overrides
       public_eth:
         value: 'eth2'

##############################################################################
# By editing the override-config sections below, you can override arbitrary
# configuration name-space settings
dea-override-config:
  environment:
    mode: ha
    net_segment_type: tun
    name: onos_no-ha

  wanted_release: Kilo on Ubuntu 14.04
  nodes:
  - id: 1
    interfaces: interfaces_1
    role: mongo,controller,onos
    transformations: transformations_1
  - id: 2
    interfaces: interfaces_1
    role: ceph-osd,compute
    transformations: transformations_2
  - id: 3
    interfaces: interfaces_1
    role: ceph-osd,compute
    transformations: transformations_2
  - id: 4
    interfaces: interfaces_1
    role: ceph-osd,compute
    transformations: transformations_2

# Unique network transformation for ONOS deployment
  interfaces_1:
    eth0:
    - fuelweb_admin
    eth2:
    - public
    eth3:
    - private
    - management
    - storage
  transformations_1:
    transformations:
    - action: add-br
      name: br-fw-admin
    - action: add-br
      name: br-mgmt
    - action: add-br
      name: br-storage
    - action: add-br
      name: br-ex
    - action: add-br
      name: br-floating
      provider: ovs
    - action: add-patch
      bridges:
      - br-floating
      - br-ex
      mtu: 65000
      provider: ovs
    - action: add-br
      name: br-mesh
    - action: add-port
      bridge: br-fw-admin
      name: eth0
    - action: add-port
      bridge: br-mgmt
      name: eth3.100
    - action: add-port
      bridge: br-storage
      name: eth3.200
    - action: add-port
      bridge: br-ex
      name: eth2.753
    - action: add-port
      bridge: br-mesh
      name: eth3.300
  transformations_2:
    transformations:
    - action: add-br
      name: br-fw-admin
    - action: add-br
      name: br-mgmt
    - action: add-br
      name: br-storage
    - action: add-br
      name: br-mesh
    - action: add-port
      bridge: br-fw-admin
      name: eth0
    - action: add-port
      bridge: br-mgmt
      name: eth3.100
    - action: add-port
      bridge: br-storage
      name: eth3.200
    - action: add-port
      bridge: br-mesh
      name: eth3.300

  settings:
    editable:
      public_network_assignment:
        assign_to_all_nodes:
          # ONOS should not have public network assignment to computes
          value: false
      additional_components:
        ceilometer:
          description: If selected, Ceilometer component will be installed
          label: Install Ceilometer
          type: checkbox
          value: true
          weight: 40
        heat:
          description: ''
          label: ''
          type: hidden
          value: true
          weight: 30
        metadata:
          label: Additional Components
          weight: 20
      storage:
        ephemeral_ceph:
          description: Configures Nova to store ephemeral volumes in RBD. This works
            best if Ceph is enabled for volumes and images, too. Enables live migration
            of all types of Ceph backed VMs (without this option, live migration will
            only work with VMs launched from Cinder volumes).
          label: Ceph RBD for ephemeral volumes (Nova)
          type: checkbox
          value: true
          weight: 75
        images_ceph:
          description: Configures Glance to use the Ceph RBD backend to store images.
            If enabled, this option will prevent Swift from installing.
          label: Ceph RBD for images (Glance)
          restrictions:
          - settings:storage.images_vcenter.value == true: Only one Glance backend could
              be selected.
          type: checkbox
          value: true
          weight: 30

dha-override-config:
#  disks:
#    contrail: 500G

##############################################################################
# The verification pipeline may populate the section below with arbitrary
# testing information, which post deploy can be retreived from the fuel master:
# /root/deploy-config.yaml
test:
